# MCP Context Saver

A powerful tool for analyzing Model Context Protocol (MCP) servers and creating intelligent LLM-powered wrappers that enhance their functionality.

## Features

- **🔍 Server Analysis**: Automatically discover and analyze MCP server capabilities
- **🤖 LLM-Powered Wrappers**: Generate intelligent wrappers that understand how to use server tools
- **📊 Expert Configuration**: Create specialized expert configurations with custom system prompts
- **🚀 Easy CLI**: Simple command-line interface for both analysis and serving
- **🧪 Full Test Coverage**: Comprehensive unit and integration tests

## Quick Start

### Installation

```bash
npm install -g mcp-context-saver
```

### Setup

Set your OpenAI API key:

```bash
export OPENAI_API_KEY=your-api-key-here
```

### Analyze an MCP Server

Analyze any MCP server to understand its capabilities:

```bash
mcp-context-saver analyze /path/to/your/mcp-server
```

This will:
1. Connect to the MCP server
2. Discover all available tools, resources, and prompts
3. Use an LLM to generate an expert configuration
4. Save the configuration to a JSON file

### Run the Wrapper Server

Use the generated configuration to run an intelligent wrapper:

```bash
mcp-context-saver serve ./configs/your-server-config.json
```

The wrapper server provides:
- **Smart Tool Coordination**: Uses LLMs to determine which tools to use
- **Three Operation Modes**: Discover, Execute, and Explain
- **Unified Expert Interface**: Single tool that handles complex multi-step operations

## How It Works

### 1. Analysis Phase

```mermaid
graph LR
    A[MCP Server] --> B[Analyzer]
    B --> C[Capability Discovery]
    C --> D[LLM Analysis]
    D --> E[Expert Configuration]
```

The analyzer:
- Connects to your MCP server
- Discovers all available tools, resources, and prompts
- Uses an LLM to understand the server's purpose and capabilities
- Generates a specialized expert configuration with system prompts

### 2. Wrapper Phase

```mermaid
graph LR
    A[User Query] --> B[Expert Tool]
    B --> C[LLM Coordination]
    C --> D[Wrapped Server]
    D --> E[Results]
```

The wrapper:
- Presents a single expert tool to clients
- Uses LLM coordination to understand user requests
- Automatically selects and calls the appropriate underlying tools
- Returns structured results

## CLI Reference

### `analyze` Command

Analyze an MCP server and generate configuration:

```bash
mcp-context-saver analyze <server-path> [args...]
```

**Arguments:**
- `<server-path>`: Path to the MCP server executable
- `[args...]`: Optional arguments to pass to the server

**Examples:**
```bash
# Analyze a local server
mcp-context-saver analyze ./my-server.js

# Analyze with arguments
mcp-context-saver analyze /usr/local/bin/mcp-server --config server.json

# Analyze a Python server
mcp-context-saver analyze python my_mcp_server.py
```

### `serve` Command

Start the wrapper server with a configuration:

```bash
mcp-context-saver serve <config-path>
```

**Arguments:**
- `<config-path>`: Path to the configuration file generated by `analyze`

**Example:**
```bash
mcp-context-saver serve ./configs/file-manager-1609459200000.json
```

## Expert Tool Interface

The wrapper creates a single expert tool that supports three operation modes:

### Discover Mode

Learn what the expert can do:

```json
{
  "name": "file-manager-expert",
  "arguments": {
    "query": "What can you help me with?",
    "mode": "discover"
  }
}
```

Returns:
- Summary of capabilities
- List of available tools
- Available resources and prompts

### Execute Mode (Default)

Perform tasks using the underlying server:

```json
{
  "name": "file-manager-expert",
  "arguments": {
    "query": "List all files in the /home directory"
  }
}
```

The LLM coordinator will:
- Understand the request
- Select appropriate tools
- Execute the operations
- Return structured results

### Explain Mode

Get information about the expert:

```json
{
  "name": "file-manager-expert",
  "arguments": {
    "query": "How do you work?",
    "mode": "explain"
  }
}
```

Returns:
- Expert description
- System prompt used for coordination
- Available tools
- Usage instructions

## Configuration Format

Generated configurations follow this structure:

```json
{
  "name": "File System Expert",
  "description": "Expert for managing files and directories",
  "serverPath": "/path/to/server",
  "args": ["--option", "value"],
  "systemPrompt": "You are a file system expert...",
  "capabilities": {
    "tools": [
      {
        "name": "list_files",
        "description": "List files in a directory"
      }
    ],
    "resources": [],
    "prompts": []
  },
  "metadata": {
    "analyzedAt": "2023-12-07T10:30:00.000Z",
    "toolCount": 5,
    "resourceCount": 0,
    "promptCount": 0
  }
}
```

## Development

### Prerequisites

- Node.js 18+
- OpenAI API key

### Setup

```bash
git clone https://github.com/your-org/mcp-context-saver.git
cd mcp-context-saver
npm install
npm run build
```

### Running Tests

```bash
# Run all tests
npm test

# Run unit tests only
npm run test:unit

# Run integration tests only
npm run test:integration
```

### Development Commands

```bash
# Build the project
npm run build

# Run CLI in development
npm run dev -- analyze ./test-server.js

# Clean build artifacts
npm run clean
```

## Project Structure

```
mcp-context-saver/
├── src/
│   ├── analyzer.ts      # MCP server analysis logic
│   ├── wrapper.ts       # Wrapper server implementation
│   ├── cli.ts           # Command-line interface
│   └── types.ts         # Shared TypeScript types
├── tests/
│   ├── integration/
│   │   ├── full-flow.test.ts    # End-to-end tests
│   │   └── mock-server.ts       # Test MCP server
│   └── unit/
│       ├── analyzer.test.ts     # Analyzer unit tests
│       └── wrapper.test.ts      # Wrapper unit tests
├── configs/             # Generated configurations (gitignored)
├── package.json
├── tsconfig.json
├── jest.config.js
└── README.md
```

## Examples

### Example: File Manager Server

```bash
# 1. Analyze a file manager MCP server
mcp-context-saver analyze ./file-manager-server.js

# Output:
# ✓ Analysis complete!
# Expert: File System Expert
# Description: Comprehensive file and directory management with search capabilities
# 
# Capabilities discovered:
#   - 8 tools
#   - 2 resources  
#   - 1 prompts
#
# Configuration saved to: ./configs/file-system-expert-1609459200000.json

# 2. Start the wrapper server
mcp-context-saver serve ./configs/file-system-expert-1609459200000.json

# 3. Use from another MCP client
# The expert tool can now handle requests like:
# "Please find all .js files in the project directory and show me the largest ones"
```

## Advanced Usage

### Custom System Prompts

The analyzer generates intelligent system prompts based on discovered capabilities. For example:

```
You are a File System Expert with comprehensive file and directory management capabilities.

Your available tools allow you to:
- List and search files and directories
- Read and write file contents
- Create and delete files and directories
- Check file permissions and metadata

When users request file operations:
1. Use list_files to explore directory structures
2. Use read_file to examine file contents
3. Use write_file to create or modify files
4. Use search_files to find specific files by pattern

Always confirm destructive operations before executing them.
```

### Error Handling

The system provides detailed error messages and suggestions:

```bash
# Missing API key
Error: OPENAI_API_KEY environment variable is required
Please set your OpenAI API key:
  export OPENAI_API_KEY=your-api-key

# Server connection issues
Error: Failed to connect to MCP server
Make sure the server path is correct and the server is executable.
You may need to build the server or install its dependencies first.
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests for new functionality
5. Ensure all tests pass
6. Submit a pull request

## License

MIT License - see LICENSE file for details.

## Support

- Create an issue on GitHub for bugs or feature requests
- Check the integration tests for usage examples
- Review the CLI help: `mcp-context-saver --help`